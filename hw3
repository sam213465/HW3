#include <iostream>
#include <fstream>
#include <string>
using namespace std;

struct Node {
  int r;
  int c;
  int dir;
  Node * next;
};

class Maze {
 private:
  int column;
  int row;
  char **grid;
 public:
  Maze(string filename) {
    ifstream fin(filename);
    if (!fin.is_open()) {
      cout << endl << filename << " does not exist!" << endl << endl;
    } else {
      fin >> column >> row;

      grid = new char*[row];
      for (int i = 0; i < row; i++) {
        grid[i] = new char[column];
      }
      for (int i = 0; i < row; i++) {
        for (int j = 0; j < column; j++) {
          fin >> grid[i][j];
        }
      }
    }
    fin.close();
  }

  ~Maze() {
    for (int i = 0; i < row; i++) {
      delete [] grid[i];
    }
    delete [] grid;
  }
  
  char Getgrid(int x, int y) {
  	return grid[x][y];
  }
  void Setgrid(int x, int y, char val) { 
    grid[x][y] = val; 
  }
  int Getrow() {
  	return row;
  }
  int Getcolumn() {
  	return column;
  }

  bool Inbounds(int x, int y) {
    if (x >= 0 && x < row && y >= 0 && y < column) {
      return true;
	}
	return false;
  }
  void Print(int row, int column) {
  	for (int i = 0; i < row; i++) {
  	  for (int j = 0; j < column; j++) {
  	  	cout << grid[i][j];
      }
	  cout << endl;
	}
  }
  
  void Copy(int row, int column) {
  	for (int i = 0; i < row; i++) {
  	  for (int j = 0; j < column; j++) {
  	  	if (grid[i][j] == 'V') {
  	      grid[i][j] = 'R';
		}
      }
	}
  }
};

class Stack {
 private:
  Node * top;
 public:
  Stack() {
    top = NULL;
  }
  ~Stack() {
    while (top) {
    Node *temp = top;
    top = top->next;
    delete temp;
    }
  }

  bool Isempty() {
    if (top == NULL) {
      return true;
    }
    return false;
  }

  void push(int r, int c, int d) {
    Node *newnode = new Node;
    newnode->r = r;
    newnode->c = c;
    newnode->dir = d;
    newnode->next = top;
    top = newnode;
  }

  bool pop(int &x, int &y, int &dir) {
    if (!top) return false;
    x = top->r;
    y = top->c;
    dir = top->dir;
    Node *temp = top;
    top = top->next;
    delete temp;
    return true;
  }
};
int dx[4] = {0, 1, 0, -1};  // 右 下 左 上
int dy[4] = {1, 0, -1, 0};

void Mission1(Maze &maze) {
  if (maze.Getcolumn() == 0 || maze.Getrow() == 0) {
    return;
  }
  Stack path;
  int x = 0, y = 0, dir = 0;

  path.push(x, y, dir);
  maze.Setgrid(x, y, 'V'); 

  while (!path.Isempty()) {

    x += dx[dir];
    y += dy[dir];

    path.push(x, y, dir);
    if (!maze.Inbounds(x, y) || maze.Getgrid(x, y) == 'O' || maze.Getgrid(x, y) == 'V') {
      path.pop(x, y, dir);  // 死路後退 

      if (path.Isempty()) break;
            
      int tmpx, tmpy;
      path.pop(tmpx, tmpy, dir);  // 回到上一步 
      x = tmpx;
      y = tmpy;
            
      dir = (dir + 1) % 4;
      path.push(x, y, dir);
      continue;
    }

    if (maze.Getgrid(x, y) != 'G') {
      maze.Setgrid(x, y, 'V');
    }

    if (maze.Getgrid(x, y) == 'G') {
      path.push(x, y, dir);
      break;
    }
        
  }
    
  maze.Print(maze.Getrow(), maze.Getcolumn());
  maze.Copy(maze.Getrow(), maze.Getcolumn());
  cout << endl; 
  maze.Print(maze.Getrow(), maze.Getcolumn());
  cout << endl << endl;
}

int main() {
  
  while (1) {
    cout << "*** (^_^) Data Structure (^o^) ***" << endl;
    cout << "*** Find the Goal(s) in a Maze ***" << endl;
    cout << "* 0. Quit                        *" << endl;
    cout << "* 1. Find one goal               *" << endl;
    cout << "* 2. Find goal(s) as requested   *" << endl;
    cout << "* 3. How many goals?             *" << endl;
    cout << "* 4. Shortest path to one goal   *" << endl;
    cout << "**********************************" << endl;
    string command;
    cout << "Input a command(0, 1, 2, 3, 4): ";
    cin >> command;
    if (command == "1") {
      int filenumber;
      cout << "Input a file number: ";
      cin >> filenumber;
      string filename = "input" + to_string(filenumber) + ".txt";
      Maze maze(filename);
      Mission1(maze);
    } else if (command == "2") {
      int goals;
      cout << "Number of G (goals):";
      cin >> goals;
    } else if (command == "3") {
      cout << "not"; 

    } else if (command == "4") {
      int filenumber;
      cout << "Input a file number: ";
      cin >> filenumber;
     // maze(filenumber);
    } else if (command == "0") {
      break;
    }
  }
  return 0;
}
  
